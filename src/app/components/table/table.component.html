<div class="table-container">
  <table class="table">
    <thead>
      <tr class="table__row">
        <th *ngFor="let header of headers" class="table__header" (click)="onSort(header)">
          {{ header }}
          <span class="table__header-sort" *ngIf="sort?.column === header">
            {{ sort?.direction === 'asc' ? '↑' : '↓' }}
          </span>
        </th>
      </tr>
    </thead>
    <ng-container *ngIf="data$ | async as data">
      <tbody>
        <ng-container *ngIf="sort; else noSort">
          <ng-container
            *ngTemplateOutlet="
              tableRows;
              context: {
                rowData: data | hasValue : filter | sortByField : sort.column : sort.direction
              }
            "
          ></ng-container>
        </ng-container>
        <ng-template #noSort>
          <ng-container *ngTemplateOutlet="tableRows; context: { rowData: data | hasValue : filter }"></ng-container>
        </ng-template>
      </tbody>
    </ng-container>
  </table>
</div>

<ng-template #tableRows let-rowData="rowData">
  <ng-container *ngFor="let item of rowData">
    <tr class="table__row">
      <td *ngFor="let header of headers" class="table__cell">
        {{ item[header] }}
      </td>
    </tr>
  </ng-container>
</ng-template>
